---
editor_options: 
  chunk_output_type: console
---

# Regular expressions and testthat

```
are_fasta_filenames <- function() {
  # ...
  pattern = ".*\\.(fas|fasta|FAS|FASTA)$"
  # ...
}

is_xml_opening_tag <- function() {
  # ...
  pattern = "<[A-Za-z_]* "
  # ...
}

is_xml_closing_tag <- function() {
  # ...
  pattern = "</[A-Za-z_]*>"
  # ...
}

is_ns_mcmc <- function() {
  # ...
  pattern = ".*beast.gss.NS.*"
  # ...
}


is_dna_seq <- fucntion() {
  # ...
  pattern = "[acgt]*")[1, 1]
  # ...
}


time_str_to_n_sec <- function() {
  # ...
  pattern = "((.)-)?(..):(..):(..)"
  # ...
}

is_on_peregrine_worker_node <- function() {
  pattern = "pg-node[0-9]{3}"
}

is_relevant_title <-function() {
  pattern = "(evolutio|immunolo|speciation)"
}

is_jar_path <- function() {
  pattern = "(.*/)?(launcher|beast)\\.jar$")
}

get_mhcnuggets_version <- function() {
  pattern = "Version: (.*)"
}

get_pureseqtm_version.R <- function() {
  pattern = "v[[:digit:]]\\.[[:digit:]]{1,2}"
}

create_covid_fig <- function() {
  pattern = "..\\|.*\\|(.*)_SARS2"
}

collect_run_times <- function() {
  pattern = "State.*: (CANCELLED|COMPLETED|RUNNING)"
}

collect_run_times <- function() {
  pattern = "Used CPU time .*:.*((.-)?..:..:..) "
}

thesis_synthesis_create_figures <- function() {
  pattern = "^.*\\.(R|Rmd|java|cpp|h)$"
}
```

## Goal

In this chapter, you will learn:

 * How to express your ideas as a regular expression
 * Verify that you indeed did so

## Why is this important?

Knowing the basics of regular expressions, prevents you having
to hand-craft functions to detect patterns in any text.

Being able to verify your own assumptions allows you to speed
up any development of any code. It is estimated that 80-90%
of all the time, we are debugging our code. Being good at 
testing, is the way to become faster.

## Overview

In this chapter, we will first start by writing and
testing code to detect a Dutch zip code.

After this, we will learn some more complex expressions,
so you understand most when searching the internet.

## What are regular expressions?

A regular expression 'is a sequence of characters that define a 
search pattern'. Such a pattern may be a zip code, a date,
or any other text of which you can say: 'this is not just text,
it is a [something]'.

For example, take a Dutch zip code: `9747 AG`. Dutch zip
code have four digits, a space and then two uppercase 
alphabet characters.

## Our first test

The `testthat` package is the Tidyverse package to write tests.

```{r}
library(testthat)
```

All test functions start with `expect_`, for example:

```{r}
expect_true("cat" != "dog")
expect_equal(1 + 1, 2)
```

## Our first Dutch zip code tests

We will be writing the function `is_dutch_zip_code`
to determine if a piece of text matches a Dutch zip code.

First, as is good practice, we will be writing the tests:

```
expect_true(is_dutch_zip_code("1234 AA"))
expect_true(!is_dutch_zip_code("1234AA"))
expect_true(!is_dutch_zip_code(" 1234 AA"))
expect_true(!is_dutch_zip_code("1234 AA "))
expect_true(!is_dutch_zip_code("1234 aa"))
expect_true(!is_dutch_zip_code("nonsense"))
```


